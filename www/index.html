<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<title>Music similarity browser</title>
<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Pontano+Sans' rel='stylesheet' type='text/css'>
<style type="text/css">

body {
    background-color: #ebebeb;
    margin-top: 0px;
}

#wrapper {
    margin: 0px auto;
    width: 997px;
    background-color: white;
}

#header {
    padding-left: 40px;
    padding-top: 3px;
    padding-bottom: 15px;
    font-family: 'Open Sans', sans-serif;
}

#header h1 {
    font-size: 28px;
}

circle.root{
    fill: grey;
    fill-opacity: 0.7;
}

circle {
    fill: #33648e;
    fill-opacity: .5;
    stroke: rgb(31, 119, 180);
    stroke-width: 1px;
}

circle.child {
    fill: #15c136;
    stroke: #075614;
    fill-opacity: .8;
    cursor:pointer;

}

circle:hover {
    stroke: #000000;
    stroke-width: 2px;
}

circle[hover="true"] {
    stroke: #000000;
    stroke-width: 2px;
}

circle[hover="child"] {
    stroke: #000000;
    stroke-width: 2px;
}

text {
    cursor:pointer;
    font: 10px sans-serif;
    fill: white;
}

#header {
    float: left;
}

#infoWrapper {
    font-family: 'Pontano Sans', sans-serif;
    height: 550px;
    width: 340px;
    clear: both;
    float: right;
}

#infos {
    height: 470px;
    margin-top: 10px;
    overflow-y: hidden;
    clear:both;
}

#infoHead{
    font: 20px serif;
    height: 30px;
    width: 330px;
    float: right;
    margin-right: 10px;
    margin-bottom: 20px;
}

#infos div {
    cursor:pointer;
    margin-bottom: 5px;
}

#infos div[depth="1"]{
    font-size: 16px;
}

#infos div[child="true"]{
    color: #363434;
    font-weight: normal;
    font-size: 16px;
    text-indent: 3em;
}

#infos div[child="true"][depth="3"]{
    color: #464444;
    font-weight: normal;
    font-size: 15px;
    text-indent: 5em;
}

#svgWrapper {
    clear: left;
    padding-top: 1px;
}

svg#main{
    float: left;
    position: absolute;
    margin-left: 40px;
    border: 1px solid #DEDEDE;
}

#search {
    height: 61px;
    float: right;
    padding-top: 30px;
    padding-right: 35px;
    font-family: 'Pontano Sans', sans-serif;
    font-size: 16px;
    color: grey;
}

#progress {
    font-size: 20px;
    font-style: italic;
    font-weight: bold;
    color:  #15c136;
}

#legendContainer {
    float: left;
    margin-top: 580px;
    margin-left: 75px;
    width: 420px;
}

#legend {
    padding-top: 20px;
    float:right;
}

.legende {
    font: 15px sans-serif;
    color: #888;
}

#sizeLegend {
    height: 130px;
    width: 200px;
    margin-left: 50px;
    float:left;
}
.sizeLegendSpan {
    position: absolute;
    border-top: solid 1px #BBB;
    width: 50px;
    margin-left: 60px;
    margin-top: 679px;
}

#sizeLegend .sizeLegendSpan span {
    font: 15px sans-serif;
    color: #888;
    position: absolute;
    display: block;
    left: 55px;
    top: -8px;
    width: 100px;
}

.sizeLegendCircle {
    stroke-width: 1;
    stroke: #565454;
    stroke-dasharray: 3 3;
    stroke-linecap: round;
    fill:none;
}

.ui-menu {
    font: 15px sans-serif;
}

#similarTo {
    margin-left: 90px;
    color: #a5a5a5;
    margin-top: 12px;
}

#secondScreen {
    clear: both;
    font-family: 'Pontano Sans', sans-serif;
    margin: 40px;
}

#secondScreen h2 {
    text-align: center;
    font-size: 28px;
}

#interestingFinds {
    padding-top: 30px;
}

#plainTextLink {
    float: right;
    margin-top: -20px;
    margin-right: 68px;
}

#sourceLink {
    position: absolute;
    margin-left: 313px;
    margin-top: -19px;
    font-size: 12px;
}

#socialButtons {
    position: absolute;
    margin-left: 437px;
    padding-top: 33px;
}

#twitterButton {
    margin-top: -2px;
}

</style>
</head>
<body>

<!--
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
-->

<div id = "wrapper">

    <div id="firstScreen">

        <div id="header">
            <h1>
                Similar Music
            </h1>
        </div>

        <div id="socialButtons">

            <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.peachnote.com%2Fsimilarity&amp;send=false&amp;layout=button_count&amp;width=90&amp;show_faces=false&amp;font=arial&amp;colorscheme=light&amp;action=like&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:21px;" allowTransparency="true"></iframe>

            <a href="https://twitter.com/share" class="twitter-share-button" data-text="Check out the music similarity browser" data-via="peachnote" data-count="none">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

        </div>

        <div id="search">
            <input type="text" id="scoreId" style="width:300px;" spellcheck="false">
            <div id="progress"></div>
        </div>

        <div id="infoWrapper">
            <div id="infoHead"></div>
            <span id="similarTo">is similar to works by</span>
            <div id="infos"></div>
        </div>

        <div id="svgWrapper">
            <a id="plainTextLink" href="http://www.peachnote.com/similarity.html" target='_blank'>text version</a>
        </div>


        <div id="legendContainer">

            <div id="sizeLegend">
                <div style="top:10px;" class="sizeLegendSpan"><span>Similarity node</span></div>
                <div style="top:45px;" class="sizeLegendSpan"><span>higher similarity</span></div>
                <div style="top:90px;" class="sizeLegendSpan"><span>lower similarity</span></div>
                <svg id="sizeLegendCircle">
                    <circle r="50" class="sizeLegendCircle" cx="50" cy="60"></circle>
                    <circle r="30" class="sizeLegendCircle" cx="50" cy="40"></circle>
                    <circle r="18" class="sizeLegendCircle" cx="50" cy="90"></circle>
                </svg>
            </div>

            <div id="legend">
                <svg height="20" width="50">
                    <rect x="25" y="5" height="15" width="25" style="stroke:#000066; fill: #33648e; fill-opacity: .5;"/>   </svg>
                <span class="legende">Composer</span>
                <br>
                <svg height="20" width="50">
                    <rect x="25" y="5" height="15" width="25" style="stroke:#000066; fill: #33648e; fill-opacity: .8;"/>   </svg>
                <span class="legende">Composition</span>
                <br>
                <svg height="20" width="50">
                    <rect x="25" y="5" height="15" width="25" style="stroke:#006600; fill: #00cc00"/>   </svg>
                <span class="legende">Score</span>
            </div>

            <a href="http://www.peachnote.com">
                <img src="img/powered-by-peachnote-transparent-small.png" style="height:40px; margin-top:30px; margin-left: 400px; position: absolute;">
            </a>

        </div>

    </div>

    <div id="secondScreen">

        <div id="interestingFinds">

            <h2>Interesting Finds</h2>

            <a href="#IMSLP29616">Violin schools are similar</a>


        </div>

        <div id="about">

            <h2>About</h2>

            How is the similarity measured?
            <p>

                Who made this? Photos go here.
            <p>

        </div>

    </div>
</div>


<script type="text/javascript">

function Scroll(pos) {
    $('#infos').scrollTop(pos);
}

$(document).ready(function() {
	

    var developer = false;
    var clicked = false;

    var DEFAULT_SCORE = "IMSLP00001";
    var MAX_LIST_LENGTH_NO_SCROLL = 19;
    var TRANSITION_DURATION = 2000;
    var SEARCH_HINT = 'Explore scores...';
    var PLAIN_TEXT_URL = 'http://www.peachnote.com/similarity.html';
    var INFO_HEIGHT = 470;
    var INFOWRAPPERHEIGHT = 550;

    var downImageBase64 = "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";
    var upImageBase64 = "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";

    var w = 550,
            h = 550,
            r = 550,
            x = d3.scale.linear().range([0, r]),
            y = d3.scale.linear().range([0, r]),
            node,
            root,
            format = d3.format(",d");

    var zoomable=false;
    var zoomed=false;
    var zoomedNode;

    var pack = d3.layout.pack()
            .size([r, r])
            .value(function(d) { return Math.pow(Math.log(d.score),3); })


    var vis = d3.select("#svgWrapper").append("svg")
            .attr("id", "main")
            .attr("width", w)
            .attr("height", h)
            .attr("transform", "translate(" + (w - r) / 2 + "," + (h - r) / 2 + ")");

    var circles = vis.append("g").attr("id", "circles");
    var texte = vis.append("g").attr("id", "texte");

    var scoreTitle = "";
    var scoreAuthor;

    window.onhashchange = function() {
        if (!location.hash) {
            update(DEFAULT_SCORE);
        } else {
            update(location.hash.replace('#',''));
        }
    }

    var loadScore = function(scoreId) {
        location.hash = "#" + scoreId;
    }

    //Autocomplete Search
    $(function() {

        $("#scoreId").autocomplete({
            source: function( request, response ) {
                $.ajax({
                    url: 'http://www.peachnote.com/rest/api/v1/scoreSearchMeta?app_id=abe33d61&app_key=b985ac7a9881a67de8a7b069d295b3fe&offset=0',
                    dataType: "jsonp",
                    data: {
                        limit:10,
                        q: '(title:"'+request.term+'"~0) (composer:'+request.term+')^2'
                    },
                    success: function(data) {
                        response( $.map( data.items, function( item ) {
                            return {
                                label: item.authors[0]+", "+item.title,
                                value: item.authors[0]+", "+item.title,
                                scoreId: item.scoreId
                            }
                        }));
                    }
                });
            },
            minLength: 2,
            select: function( event, ui ) {
                $('#progress').text("Getting Data...");
                update(ui.item.scoreId);
            }
        });

    });



    var onRelatedScoreData = function (data) {

        if ($("#scoreId").val() != SEARCH_HINT) $("#scoreId").val("");

        if (data.relatedScores.length == 0) {
			$('#progress').text('');
            alert("no similarity data available yet");
            return;
        }

        var scoreDescriptionURL ="http://www.peachnote.com/rest/api/v1/scoreSearchMeta?" +
                "app_id=abe33d61&app_key=b985ac7a9881a67de8a7b069d295b3fe" +
                "&offset=0&limit=1&q=%20id:" + data.scoreId;

        $.ajax({
            type: "GET",
            url: scoreDescriptionURL,
            dataType: "jsonp",
            success: getSimilarityScore,
            error: errorFunction
        });

        var scores = data.relatedScores;
        var rootName = data.scoreId;

        var len = scores.length;

        var comps = {};
        var aComps = [];
        var scoreValues = 0;


        for (var i = 0; i < len; i++) {
            var s = scores[i];
            scoreValues += scoreValues + s.count;
            var url = document.location.pathname
                    + "?scoreId=" + s.scoreId;

            var componistName;
            if (developer) {
                componistName = typeof s.composer === 'undefined' ? 'undefined' : s.composer;
            } else {
                if (typeof s.composer === 'undefined') {
                    continue;
                }
                componistName= s.composer;
            }
            if (typeof comps[componistName] === 'undefined') {
                comps[componistName] = {
                    name: componistName,
                    dChildren: {},
                    children: [],
                    score: 0
                };
                aComps.push(comps[componistName]);
            }
            var componist = comps[componistName];
            componist.score += s.count;


            var workTitleName = typeof s.workTitle === 'undefined' ? 'undefined' : s.workTitle;
            if (typeof componist.dChildren[workTitleName] === 'undefined') {
                componist.dChildren[workTitleName] = {
                    name: workTitleName,
                    composer: s.composer,
                    score: 0,
                    children: []
                };
                componist.children.push(componist.dChildren[workTitleName]);
            }
            var workTitle = componist.dChildren[workTitleName];
            workTitle.score += s.count;
            workTitle.children.push({
                name: typeof s.scoreTitle === 'undefined' ? 'undefined' : s.scoreTitle+"id:"+s.scoreId,
                composer: typeof s.scoreTitle === 'undefined' ? 'undefined' :s.composer,
                composition: typeof s.scoreTitle === 'undefined' ? 'undefined' :s.workTitle,
                year: typeof s.scoreTitle === 'undefined' ? 'undefined' :s.year,
                score: s.count,
                scoreId: s.scoreId
            });
        }

        var dataset = {"root":rootName, "scoreId": data.scoreId, "name":scoreTitle, "score":scoreValues, "children":aComps};
        updateData(dataset);
        
    };

    var getSimilarityScore = function(data) {

        var scoreId = data.items[0].scoreId;

        scoreTitle = typeof data.items[0] !== 'undefined' ? data.items[0].title : scoreId;
        scoreAuthor = typeof data.items[0] !== 'undefined' ? data.items[0].authors : '';

        var header = d3.select('#infoHead');
		
        header.selectAll("span.headline").remove();
        header.selectAll("span.headline").data(scoreAuthor)
              .enter().append("span").attr("class","headline")
              .text(function(d){return d});

        header.select("div.headline").remove();
        header.append("div").attr("class", "headline")
              .text(function() {
                    if (scoreTitle.length > 35) {
                        return scoreTitle.substring(0, 35) + "...";
                    } else {
                        return scoreTitle;
                    }
              });


        var pureId = scoreId.substring(5);


        $("#sourceLink").detach();
        $("<a>").attr("id", "sourceLink")
                .attr("href", "http://imslp.org/wiki/Special:ReverseLookup/" + pureId)
                .attr("target", "_blank")
                .text("[link]")
                .appendTo($('#infoHead'));
    }

    var errorFunction = function(){
        $('#progress').text('Error. Please try again.');
    }

    var update = function(id) {

        $('#plainTextLink').attr('href', PLAIN_TEXT_URL + '?scoreId=' + id);

        if (!$('#scoreId').is(":focus")) {
            $('#scoreId').val(SEARCH_HINT);
        } else {
            $('#scoreId').val();
        }
        $('#scoreId').on('focus', function() {
            if ($('#scoreId').val() == SEARCH_HINT) {
                $('#scoreId').val("");
            }
        });
        $('#scoreId').on('blur', function() {
            if ($('#scoreId').val() == '') {
                $('#scoreId').val(SEARCH_HINT);
            }
        });

        $('#infos').scrollTop(0);


        var relatedScoresURL = "http://www.peachnote.com/rest/api/v1/score?withRelated=true&callback=?&id=" + id;


        $.ajax({
            type: "GET",
            url: relatedScoresURL,
            dataType: "jsonp",
            success: onRelatedScoreData,
            error: errorFunction
        });
    }

    function updateData(data){
        zoomed = false;
        zoomable = false;

        zoomedNode = node = root = data;

        d3.selectAll("circle title").remove();

        var nodes = pack.nodes(root).filter(function(d) { return d.score; });
        var key = function(d) {
            if (d.root) return d.scoreId;
            else if (d.children) return d.name;
            else return d.scoreId;
        }
        var circle = circles.selectAll("circle")
                .data(nodes, key);

        circle.attr("class", function(d) { if (d.root) { return "root"} else {return d.children ? "parent" : "child";} })
                .attr("scoreId", function(d){ return d.scoreId ? d.scoreId : " ";})
                .attr("name", function(d){return d.name;})
				.attr("parent", function (d) {if(d.parent ) return d.parent.name;})
                .attr("hover","false")
                .append("title")
                .text(function(d) {
                    if (d.root) {

                        var name = '';
                        for (var author in scoreAuthor) {
                            name = name === 'undefined' ? '' : name;
                            name += " " + scoreAuthor[author] + "\n";
                        }

                        return (name + d.name.split('id:')[0]).trim();
                    }
                    else {
                        return(d.children ? "" : (d.composer === 'undefined' ? '' : d.composer + "\n")
                                + (d.composition === 'undefined' ? '' : d.composition + "\n"))
                                + d.name.split('id:')[0]
                                + "\nSimilarities: "+ format(d.score);}
                });

        circle.enter().append("svg:circle")
                .attr("class", function(d) { if(d.root){ return "root"} else{ return d.children ? "parent" : "child";} })
                .attr("scoreId", function(d){ return d.scoreId ? d.scoreId : " ";})
                .attr("name", function(d){return d.name;})
				.attr("parent", function (d) { if(d.parent )return d.parent.name})
                .attr("hover","false")
                .on("mouseover",function(d){
                    if(zoomedNode.depth<=d.depth){
                        showChildren(getParents(d),false);
                    }
                    if(checkInfoLength() && !d.root){
						updateInfoScroll(d);
                    }
                    highlightDiv(d);
                })
                .on("mouseleave", function(d) {
                    if(!zoomed || d.depth == 3) {
                        notHighlightDiv(d);
                    }
                })
                .on("click", function(d) {
                    if (d.children) {
                        zoom(node == d ? root : d);
                    } else if (d.depth == 3) {
                        if (!clicked) {
                            $('#progress').text("Getting Data...");
                            d3.select('circle[name="'+d.name+'"]').style("fill", "#288425");
                            clicked=true;
                            zoomable=false;
                            loadScore(d.scoreId);
                        }
                    }
                })
                .attr("cx", function(d) { return w/2; })
                .attr("cy", function(d) { return h/2; })
                .attr("r", function(d) { return 0; })
                .append("title")
                .text(function(d) {
                    if(d.root){

                        var name="";

                        for(var author in scoreAuthor){
                            name=name==='undefined'? '':name;
                            name+=" "+scoreAuthor[author]+"\n";
                        }

                        return (name+d.name.split('id:')[0]).trim();
                    }
                    else{
                        return (d.children ? "" : (d.composer==='undefined' ? '' : d.composer+"\n")+(d.composition==='undefined' ? '' : d.composition+"\n"))+d.name.split('id:')[0]+"\nSimilarities: "+ format(d.score) ;} });
		
		var rootCircle = $('.root');
		var target = $('#circles circle').get(0);
		rootCircle.insertBefore(target);
		
		var oldRoot = d3.select('#circles circle:nth-child(2)');
		var oldRootObject = $($('#circles circle').get(1));
		var target = $('circle[name="'+oldRoot.attr('parent')+'"]');
		oldRootObject.insertAfter(target);
		
		
        circle.transition().duration(TRANSITION_DURATION)
				.style("fill", function(d){
					if( d.root) { return "grey";}
					else if (!d.children) { return "#15c136";}
					else { return "#33648e";}
				
				})
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; })
                .attr("r", function(d) { return d.r; })
                .each("start", function(d){
                    zoomable=false;
                    $('#progress').text('');
                })
                .each("end", function(d){
                    zoomable=true;
                    clicked=false;
                });


        circle.exit().transition().duration(TRANSITION_DURATION)
                .attr("r", function(d) { return 0; }).remove();


        d3.selectAll("text tspan").remove();

        var text=texte.selectAll("text")
                .data(pack.nodes(root).filter(function(d){return !d.children;}),key);

        text.attr("class", function(d) { return "child"; })
                .style("opacity", function(d) { return 0; });


        text.enter().append("svg:text")
                .attr("class", function(d) { return "child"; })
                .attr("x", function(d) { return w/2; })
                .attr("y", function(d) { return h/2; })
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .style("opacity", function(d) { return 0; })
                .on("mouseover",function(d){
                    highlightDiv(d);
                })
                .on("mouseleave", function(d){
                    notHighlightDiv(d);
                })
                .on("click", function(d){
                    if (!clicked) {
                        $('#progress').text("Getting Data...");
                        d3.select('circle[name="' + d.name + '"]').style("fill", "#288425");
                        clicked = true;
                        zoomable = false;
                        loadScore(d.scoreId);
                    }
                });

        text.append("tspan").attr("class", "oben").attr("x",function(d) { return d.x; })
                .attr("y",function(d) { return d.y-15; })
                .text(function(d) { return d.composer.substring(0, d.r / 4); })

        text.append("tspan").attr("class", "mitte").attr("x",function(d) { return d.x; })
                .attr("y",function(d) { return d.y+5; })
                .text(function(d) { return d.composition.substring(0, d.r / 4); });

        text.append("tspan").attr("class", "unten").attr("x",function(d) { return d.x; })
                .attr("y",function(d) { return d.y+20; })
                .text(function(d) { return d.name.split('id:')[0].substring(0, d.r / 4); });


        text.transition().duration(TRANSITION_DURATION)
                .attr("x", function(d) { return d.x; })
                .attr("y", function(d) { return d.y; })
                .style("opacity", function(d) { return d.r > 25 ? 1 : 0; })
                .style("font-size", function(d) { return d.r > 25 ? 10 : 2; });

        text.exit().remove();
        initDiv(data);

    }
	function zoom(d, click) {
            zoomedNode = d;

            if (d == root) {
                zoomed = false;
            } else {
                zoomed = true;
                if (!click) {
                    showChildren(getParents(d), false);
                }
            }
            if(zoomable){
                k = r/d.r/2;
                f = d.r;
                
                x.domain([d.x - f, d.x + f]);
                y.domain([d.y - f, d.y + f]);

                var t = vis.transition()
                        .duration(d3.event.altKey ? 7500 : 750)


                t.selectAll("circle")
                        .attr("cx", function(d) { return x(d.x); })
                        .attr("cy", function(d) { return y(d.y); })
                        .attr("r", function(d) { return k * d.r; });


                t.selectAll("text")
                        .style("opacity", function(d) { return k * d.r > 25 ? 1 : 0; })
                        .style("font-size", function(d) { return k*d.r > 25 ? 10 : 2; })
                        .attr("x", function(d) { return x(d.x); })
                        .attr("y", function(d) { return y(d.y); });

                t.selectAll("tspan.oben")
                        .attr("x", function(d) { return x(d.x); })
                        .attr("y", function(d) { return y(d.y)-15; })
                        .text(function(d) { return d.composer.substring(0, k*d.r / 4); });
                t.selectAll("tspan.mitte")
                        .attr("x", function(d) { return x(d.x); })
                        .attr("y", function(d) { return y(d.y)+5; })
                        .text(function(d) { return d.composition.substring(0, k*d.r / 4); });
                t.selectAll("tspan.unten")
                        .attr("x", function(d) { return x(d.x); })
                        .attr("y", function(d) { return y(d.y)+20; })
                        .text(function(d) { return d.name.split('id:')[0].substring(0, k*d.r / 4); });

                node = d;
                d3.event.stopPropagation();
            }
        }


        function initDiv(d) {

            var infos = d3.select("div#infos");
            infos.selectAll("div").remove();
            if (d.children) {

                d.children.sort(function(a, b) {return b.score - a.score});

                var div = infos.selectAll("div").data(d.children)
                        .enter()
                        .append("div")
                        .attr("name", function(d){return d.name;})
                        .attr("id", function(d){return 'div'+d.name;})
                        .attr("depth", function(d){
                            if(!d.children){ return 3;}
                            else if(!d.composition ){
                                if(!d.composer){ return 1;
                                }else{return 2;}
                            }
                            else{ return d.depth;}
                        })

                        .text(function(d, i) {
                            var title = d.name.split('id:')[0];
                            return shorten(title);
                        })

                        .on("click", function(d){
                            if(!showChildren([d],true)){ zoom(d.parent);
                            }else{
                                zoom(node == d ? root : d ,true);
                            }
                        })
                        .on("mouseover", function(d){
                            highlightDiv(d);

                            var toSelectCircle = 'circle[name="'+d.name+'"]';
                            var circle= d3.select(toSelectCircle)
                                    .attr("hover", "true");
                        })
                        .on("mouseout", function(d){
                            d3.select('circle[hover="true"]').attr("hover","false");
                            if(!zoomed || d.depth==3){
                                notHighlightDiv(d);
                            }
                        });

                div.append("img").attr("src", "data:image/png;base64," + downImageBase64)
                        .attr("title","Click to show children")
                        .style("margin-left","2px")
                        .style("float","left")
                        .style("margin-right","5px")
                        .style("padding-top","5px");


            }
            checkInfoLength();
        }

        function getParents(d){
            var datum=d;
            var parents=[];
            parents.push(d);
            while (datum.parent) {
                datum= datum.parent;
                parents.push(datum);
            }
            return parents;
        }

        function showChildren(d,click){

            var node = d3.select('div[name="'+d[0].name+'"]');

            if (click && $('div[name="'+d[0].name+'"] div[child="true"]').length>0) {
                node.selectAll('div[child="true"]').remove();
                node.select("img").attr("src", "data:image/png;base64," + downImageBase64)
                        .attr("title","Click to show children");
                return false;
            }else{
                if(!click){
                    d3.selectAll("#infoWrapper img").attr("src", "data:image/png;base64," + downImageBase64)
                            .attr("title","Click to show children");





                    d3.selectAll('div[child="true"]').remove();
                    var depthNode=d[0].depth-1;
                    if(depthNode!=-1){
                        node= d3.select('div[name="' + d[depthNode].name + '"]');
                    }
                    node.select("img").attr("src", "data:image/png;base64," + upImageBase64)
                            .attr("title", "Click to hide children");
                } else {
                    node.select("img").attr("src", "data:image/png;base64," + upImageBase64)
                            .attr("title", "Click to hide children");
                }

                for (var i = d.length; i>0; i--) {

                    if (d[i-1].children) {

                        d[i-1].children.sort(function(a, b) {return b.score - a.score});

                        highlightDiv(d[i-1]);

                        var div = d3.select('#infos div[name="'+d[i-1].name+'"]').selectAll("div")
                                .data(d[i-1].children)
                                .enter().append("div")
                                .attr("name", function(d) {return d.name;})
                                .attr("id", function(d) {return 'div' + d.name;})
                                .attr("child","true")
                                .attr("depth", function(d) {
                                    if(!d.children){
                                        return 3;
                                    }
                                    else if (!d.composition) {
                                        if (!d.composer) {
                                            return 1;
                                        } else {
                                            return 2;
                                        }
                                    }
                                    else {
                                        return d.depth;
                                    }
                                })
                                .text(function(d, i) {
                                    //var title = (i + 1) + ". " + d.name.split('id:')[0];
                                    var title = d.name.split('id:')[0];
                                    return shorten(title);
                                })
                                .on("click", function(d){
                                    if (!d.children) {
                                        if (!clicked) {
                                            d3.select('circle[name="' + d.name + '"]').style("fill", "#288425");
                                            clicked = true;
                                            zoomable = false;
                                            $('#progress').text('Getting Data...');
                                            loadScore(d.scoreId);
                                        }
                                    }
                                    if (!showChildren([d],true)) {
                                        zoom(d.parent);
                                    } else {
                                        zoom(node == d ? root : d ,true);
                                    }
                                })
                                .on("mouseover", function(d){
                                    highlightDiv(d,true);

                                    var toSelectCircle = 'circle[name="'+d.name+'"]';
                                    var circle = d3.select(toSelectCircle).attr("hover", "child");

                                })
                                .on("mouseout", function(d){
                                    d3.select('circle[hover="child"]').attr("hover","false");
                                    if (!zoomed || d.depth==3) {
                                        notHighlightDiv(d,true);
                                    }
                                });

                        checkInfoLength();

                    }
                }
                return true;
            }
        }

        function checkInfoLength(){
            if ($("#infos div").length > MAX_LIST_LENGTH_NO_SCROLL) {
                d3.selectAll('#infos').style("overflow-y","scroll");
                return true;
            } else {
                d3.selectAll('#infos').style("overflow-y","hidden");
                return false;
            }
        }

        function highlightDiv(d,click){
            d3.selectAll('div[depth="' + d.depth + '"]')
              .attr("hover", "false")
              .style("font-weight", "normal");
            var name;
            if(click){
                name = d.name;
            }else{
                name = getName(d);
            }
            d3.select('div[name="' + name + '"]')
              .attr("hover", "true")
              .style("font-weight", "bold");
        }

        function notHighlightDiv(d,click){
            var name;
            if (click) {
                name = d.name;
            } else{
                name = getName(d);
            }
            d3.select('div[name="' + name + '"]')
                    .attr("hover", "false")
                    .style("font-weight", "normal");
        }

        function getName(d) {
            var name = '';
            if (!d.children && d.parent.children.length == 1) {
                name = d.composer;
                if (d.parent.parent.children.length > 1) {
                    name = d.parent.name;
                }
            } else {
                name = d.name;
            }
            return name;
        }

        function shorten(string) {
            if (string.length > 30) {
                return string.substring(0,30) + " ...";
            } else {
                return string;
            }
        }
		
		function updateInfoScroll(d){
			$('#infos').scrollTop(0);
            var offset=$('#infos').offset();
            var position = $('div[name="'+ getName(d)+'"]').position();
			var scrollTo = position.top - offset.top;
			
            if (position.top > INFOWRAPPERHEIGHT || position.top < $('#infos').scrollTop()) {
                if (d.depth != 1) {

					var posParent = $('div[name="'+ getName(d.parent)+'"]').position();
                    var childrenLength = 0;

                    if (d.children) {
                        childrenLength = d.children.length*30;
                    }
                    if (position.top-posParent.top < INFO_HEIGHT - childrenLength){
                        scrollTo = posParent.top - offset.top;
						if (d.parent.parent) {

                            var posParentParent = $('div[name="'+ getName(d.parent.parent)+'"]').position();
                            childrenLength = d.parent.parent.children.length*30 + d.parent.children.length*30;

                            if (position.top-posParentParent.top < INFO_HEIGHT - childrenLength){
                                scrollTo = posParentParent.top - offset.top;
                            }
                        }
                    }
                }
                Scroll(scrollTo);
                
            }
		}

    // if hash present, load appropriate score, else load the default.

    window.onhashchange();

});
</script>

<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9937279-8']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>

</body></html>